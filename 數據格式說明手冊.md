# Edge Impulse 三軸加速度數據集格式規範

## 檔案命名規則

```
caseX.sampleY.csv
```

- **caseX**: 動作分類標籤，X為分類編號
  - case1: 第一種動作（如：靜止）
  - case2: 第二種動作（如：行走）
  - case3: 第三種動作（如：跑步）
  - 依此類推...

- **sampleY**: 同一動作的第Y個數據檔案
  - sample1: 該動作的第1個採樣檔案
  - sample2: 該動作的第2個採樣檔案
  - 建議每個動作至少收集10-20個樣本檔案

## CSV檔案格式

### 檔案編碼
- UTF-8

### 欄位定義

| 欄位名稱 | 資料型態 | 單位 | 說明 |
|----------|----------|------|------|
| timestamp | Float | ms (毫秒) | 時間戳記，從0開始遞增 |
| signal_x | Float | g | X軸加速度值 |
| signal_y | Float | g | Y軸加速度值 |
| signal_z | Float | g | Z軸加速度值 |

### 資料格式範例

```csv
timestamp,signal_x,signal_y,signal_z
0.0,0.125,-0.987,0.234
1.0,0.127,-0.985,0.235
2.0,0.124,-0.988,0.233
3.0,0.126,-0.986,0.234
...
```

## 資料收集規範

### 取樣參數
- **取樣率**: 1000 Hz (1 kHz)
- **時間間隔**: 1 ms
- **加速度範圍**: ±2g
- **數據精度**: 至少3位小數

### 檔案大小建議
- **每個檔案時長**: 建議10-30秒
- **資料筆數**: 10,000-30,000筆
- **範例**: 16秒 = 16,000筆資料（如提供的範例檔）

## Arduino程式碼實作

基於MPU6050的資料收集程式：

```cpp
#include <Wire.h>
#include <SD.h>
#include <SPI.h>

// MPU6050設定
const int MPU = 0x68;
float AccX, AccY, AccZ;

// SD卡設定
#define CS_PIN 9
File dataFile;

// 計時器
unsigned long startTime;
unsigned long sampleCount = 0;
const unsigned long SAMPLE_DURATION = 16000; // 16秒
const unsigned long SAMPLE_INTERVAL = 1; // 1ms

void setup() {
  Serial.begin(115200);
  
  // 初始化MPU6050
  Wire1.setSDA(14);
  Wire1.setSCL(15);
  Wire1.begin();
  Wire1.setClock(400000);
  initMPU6050();
  
  // 初始化SD卡
  SPI1.setRX(12);
  SPI1.setTX(11);
  SPI1.setSCK(10);
  
  if (!SD.begin(CS_PIN, SPI1)) {
    Serial.println("SD卡初始化失敗");
    return;
  }
  
  // 建立CSV檔案
  String filename = "case1.sample1.csv";
  dataFile = SD.open(filename, FILE_WRITE);
  
  if (dataFile) {
    // 寫入標題列
    dataFile.println("timestamp,signal_x,signal_y,signal_z");
    Serial.println("開始記錄資料到: " + filename);
    startTime = millis();
  }
}

void loop() {
  unsigned long currentTime = millis();
  unsigned long elapsed = currentTime - startTime;
  
  // 檢查是否達到取樣時間
  if (elapsed >= sampleCount * SAMPLE_INTERVAL) {
    
    // 讀取加速度
    readAcceleration();
    
    // 寫入CSV
    dataFile.print(elapsed);
    dataFile.print(".0,");
    dataFile.print(AccX, 3);
    dataFile.print(",");
    dataFile.print(AccY, 3);
    dataFile.print(",");
    dataFile.println(AccZ, 3);
    
    sampleCount++;
    
    // 檢查是否完成
    if (elapsed >= SAMPLE_DURATION) {
      dataFile.close();
      Serial.println("資料收集完成");
      while(1); // 停止執行
    }
  }
}

void initMPU6050() {
  writeRegister(0x6B, 0x00); // 喚醒
  writeRegister(0x1C, 0x00); // ±2g
  writeRegister(0x19, 0x00); // 1kHz
}

void writeRegister(uint8_t reg, uint8_t value) {
  Wire1.beginTransmission(MPU);
  Wire1.write(reg);
  Wire1.write(value);
  Wire1.endTransmission();
}

void readAcceleration() {
  Wire1.beginTransmission(MPU);
  Wire1.write(0x3B);
  Wire1.endTransmission(false);
  Wire1.requestFrom(MPU, 6, true);
  
  if (Wire1.available() >= 6) {
    int16_t rawX = (Wire1.read() << 8) | Wire1.read();
    int16_t rawY = (Wire1.read() << 8) | Wire1.read();
    int16_t rawZ = (Wire1.read() << 8) | Wire1.read();
    
    AccX = rawX / 16384.0;
    AccY = rawY / 16384.0;
    AccZ = rawZ / 16384.0;
  }
}
```

## Edge Impulse匯入流程

1. **資料收集**
   - 每個動作類別收集10-20個檔案
   - 確保檔名格式正確（caseX.sampleY.csv）

2. **檔案整理**
   ```
   dataset/
   ├── case1.sample1.csv  (靜止-樣本1)
   ├── case1.sample2.csv  (靜止-樣本2)
   ├── case2.sample1.csv  (行走-樣本1)
   ├── case2.sample2.csv  (行走-樣本2)
   └── case3.sample1.csv  (跑步-樣本1)
   ```

3. **Edge Impulse上傳**
   - Data acquisition → Upload data
   - 選擇CSV檔案
   - 設定標籤（根據caseX命名）
   - 確認取樣率為1000Hz

## 資料品質檢查清單

- [ ] 時間戳記從0開始，間隔1ms
- [ ] 三軸數值在±2g範圍內
- [ ] 無遺失值或異常值
- [ ] 檔案大小一致（相同時長）
- [ ] 檔名符合命名規範
- [ ] CSV格式正確（逗號分隔）
- [ ] UTF-8編碼

## 注意事項

1. **資料平衡**: 確保每個動作類別的樣本數量相近
2. **環境一致**: 在相同環境條件下收集資料
3. **感測器校正**: 開始收集前確保MPU6050已校正
4. **檔案大小**: 單一檔案不建議超過30秒（30,000筆）
5. **標籤準確**: caseX必須對應正確的動作類別