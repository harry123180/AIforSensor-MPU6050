# Raspberry Pi Pico 2W 開發板技術手冊

## 硬體腳位配置表

| 模組 | 功能 | GPIO腳位 | 備註 |
|------|------|----------|------|
| **RGB LED** | Red | GP0 | 共陰極 |
| | Green | GP1 | 共陰極 |
| | Blue | GP2 | 共陰極 |
| **按鈕** | BTN1 | GP4 | 內建上拉，按下接地 |
| | BTN2 | GP5 | 內建上拉，按下接地 |
| **SD卡模組** | CS | GP9 | SPI1 Chip Select |
| | SCK | GP10 | SPI1 Clock |
| | MOSI | GP11 | SPI1 Data Out |
| | MISO | GP12 | SPI1 Data In |
| **MPU6050** | SDA | GP14 | I2C1 Data |
| | SCL | GP15 | I2C1 Clock |
| | I2C地址 | 0x68 | 7-bit address |

## 模組使用說明

### 1. RGB LED 控制

**功能描述**  
控制共陰極RGB LED，可產生各種顏色組合。

**程式碼範例**
```cpp
#define R 0
#define G 1
#define B 2

void setup() {
  Serial.begin(115200);
  pinMode(R, OUTPUT);
  pinMode(G, OUTPUT);
  pinMode(B, OUTPUT);
}

void loop() {
  // 紅色閃爍
  digitalWrite(R, HIGH);
  delay(100);
  digitalWrite(R, LOW);
  delay(100);
  
  // 綠色閃爍
  digitalWrite(G, HIGH);
  delay(100);
  digitalWrite(G, LOW);
  delay(100);
  
  // 藍色閃爍
  digitalWrite(B, HIGH);
  delay(100);
  digitalWrite(B, LOW);
  delay(100);
}
```

### 2. 多功能按鈕

**功能描述**  
支援單擊、雙擊、三擊、長按四種操作模式。

**需求函式庫**
- Button2 by Lennart Hennigs

**程式碼範例**
```cpp
#include <Button2.h>

#define BTN1_PIN 4
#define BTN2_PIN 5

Button2 btn1;
Button2 btn2;

void setup() {
  Serial.begin(115200);
  
  // 初始化按鈕1
  btn1.begin(BTN1_PIN);
  btn1.setDebounceTime(50);
  btn1.setLongClickTime(1000);
  btn1.setDoubleClickTime(400);
  
  // 按鈕1事件處理
  btn1.setClickHandler([](Button2 &b) {
    Serial.println("BTN1: Single Click");
  });
  
  btn1.setDoubleClickHandler([](Button2 &b) {
    Serial.println("BTN1: Double Click");
  });
  
  btn1.setTripleClickHandler([](Button2 &b) {
    Serial.println("BTN1: Triple Click");
  });
  
  btn1.setLongClickHandler([](Button2 &b) {
    Serial.println("BTN1: Long Press");
  });
  
  // 按鈕2相同設定
  btn2.begin(BTN2_PIN);
  btn2.setDebounceTime(50);
  btn2.setLongClickTime(1000);
  btn2.setDoubleClickTime(400);
  
  btn2.setClickHandler([](Button2 &b) {
    Serial.println("BTN2: Single Click");
  });
  
  btn2.setDoubleClickHandler([](Button2 &b) {
    Serial.println("BTN2: Double Click");
  });
  
  btn2.setTripleClickHandler([](Button2 &b) {
    Serial.println("BTN2: Triple Click");
  });
  
  btn2.setLongClickHandler([](Button2 &b) {
    Serial.println("BTN2: Long Press");
  });
}

void loop() {
  btn1.loop();
  btn2.loop();
}
```

**時間參數設定**
- `setDebounceTime(50)`: 防彈跳時間 50ms
- `setLongClickTime(1000)`: 長按判定時間 1000ms
- `setDoubleClickTime(400)`: 雙擊間隔時間 400ms

### 3. SD卡讀寫

**功能描述**  
使用SPI1介面進行SD卡檔案讀寫操作。

**需求函式庫**
- SD (Arduino內建)
- SPI (Arduino內建)

**程式碼範例**
```cpp
#include <SPI.h>
#include <SD.h>

#define CS_PIN 9
#define SCK_PIN 10
#define MOSI_PIN 11
#define MISO_PIN 12

void setup() {
  Serial.begin(115200);
  
  // 設定自定義SPI接腳
  SPI1.setRX(MISO_PIN);
  SPI1.setTX(MOSI_PIN);
  SPI1.setSCK(SCK_PIN);
  
  Serial.println("初始化SD卡...");
  
  if (!SD.begin(CS_PIN, SPI1)) {
    Serial.println("SD卡初始化失敗");
    return;
  }
  
  Serial.println("SD卡初始化成功");
  
  // 寫入檔案
  File file = SD.open("hello.txt", FILE_WRITE);
  if (file) {
    file.println("hello world");
    file.close();
    Serial.println("檔案寫入完成");
  }
  
  // 讀取檔案
  file = SD.open("hello.txt");
  if (file) {
    Serial.println("檔案內容:");
    while (file.available()) {
      Serial.write(file.read());
    }
    file.close();
  }
}

void loop() {
  // 空迴圈
}
```

### 4. MPU6050 六軸感測器

**功能描述**  
透過I2C1介面讀取三軸加速度數據，取樣率1kHz，範圍±2g。

**需求函式庫**
- Wire (Arduino內建)

**程式碼範例**
```cpp
#include <Wire.h>

const int MPU = 0x68;
float AccX, AccY, AccZ;
unsigned long lastTime = 0;

void setup() {
  Serial.begin(115200);
  delay(3000);
  
  // 使用I2C1 (GP14/GP15)
  Wire1.setSDA(14);
  Wire1.setSCL(15);
  Wire1.begin();
  Wire1.setClock(400000); // 400kHz
  
  // 初始化MPU6050
  initMPU6050();
  
  Serial.println("MPU6050 initialized!");
  Serial.println("AccelX,AccelY,AccelZ");
}

void initMPU6050() {
  // 喚醒MPU6050
  writeRegister(0x6B, 0x00);
  delay(100);
  
  // 設定加速度範圍±2g
  writeRegister(0x1C, 0x00);
  delay(10);
  
  // 設定陀螺儀範圍±250°/s
  writeRegister(0x1B, 0x00);
  delay(10);
  
  // 設定取樣率1kHz
  writeRegister(0x19, 0x00);
  delay(10);
  
  // 關閉數位低通濾波器
  writeRegister(0x1A, 0x00);
  delay(10);
}

void writeRegister(uint8_t reg, uint8_t value) {
  Wire1.beginTransmission(MPU);
  Wire1.write(reg);
  Wire1.write(value);
  Wire1.endTransmission();
}

void readAcceleration() {
  Wire1.beginTransmission(MPU);
  Wire1.write(0x3B); // ACCEL_XOUT_H
  Wire1.endTransmission(false);
  Wire1.requestFrom(MPU, 6, true);
  
  if (Wire1.available() >= 6) {
    int16_t rawX = (Wire1.read() << 8) | Wire1.read();
    int16_t rawY = (Wire1.read() << 8) | Wire1.read();
    int16_t rawZ = (Wire1.read() << 8) | Wire1.read();
    
    // 轉換為g值 (16384 LSB/g)
    AccX = rawX / 16384.0;
    AccY = rawY / 16384.0;
    AccZ = rawZ / 16384.0;
  }
}

void loop() {
  unsigned long currentTime = millis();
  
  // 1kHz取樣率
  if (currentTime - lastTime >= 1) {
    lastTime = currentTime;
    readAcceleration();
    
    Serial.print(AccX, 3);
    Serial.print(",");
    Serial.print(AccY, 3);
    Serial.print(",");
    Serial.println(AccZ, 3);
  }
}
```

**MPU6050暫存器設定**
| 暫存器 | 地址 | 設定值 | 功能 |
|--------|------|--------|------|
| PWR_MGMT_1 | 0x6B | 0x00 | 喚醒裝置 |
| ACCEL_CONFIG | 0x1C | 0x00 | ±2g範圍 |
| GYRO_CONFIG | 0x1B | 0x00 | ±250°/s範圍 |
| SMPLRT_DIV | 0x19 | 0x00 | 1kHz取樣率 |
| CONFIG | 0x1A | 0x00 | 關閉DLPF |

## 開發環境設定

**Arduino IDE設定**
1. 開發板: Raspberry Pi Pico/RP2040
2. 串列埠速率: 115200 baud
3. 必要函式庫安裝:
   - Button2 (工具→管理程式庫→搜尋"Button2")
   - SD與Wire函式庫為內建

## 注意事項

1. **電源管理**: 確保供電穩定，特別是使用SD卡模組時
2. **I2C通訊**: MPU6050使用I2C1，避免與其他I2C裝置衝突
3. **SPI通訊**: SD卡使用SPI1，注意CS腳位管理
4. **按鈕防彈跳**: Button2函式庫已內建防彈跳機制
5. **取樣率**: MPU6050設定為1kHz高速取樣，適合即時監測應用